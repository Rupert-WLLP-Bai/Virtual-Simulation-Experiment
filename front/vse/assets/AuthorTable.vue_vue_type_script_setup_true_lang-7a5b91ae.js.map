{"version":3,"file":"AuthorTable.vue_vue_type_script_setup_true_lang-7a5b91ae.js","sources":["../../src/pages/table/AuthorTable.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\n  import { getBase64 } from '@/utils/file';\r\n  import { FormInstance } from 'ant-design-vue';\r\n  import { reactive, ref } from 'vue';\r\n  import dayjs from 'dayjs';\r\n  import { Dayjs } from 'dayjs';\r\n  import { EditFilled } from '@ant-design/icons-vue';\r\n\r\n  const columns = [\r\n    {\r\n      title: 'AUTHOR',\r\n      dataIndex: 'name',\r\n    },\r\n    { title: 'FUNCTION', dataIndex: 'position' },\r\n    { title: 'STATUS', dataIndex: 'status' },\r\n    { title: 'EMPLOYED', dataIndex: 'time' },\r\n    { title: 'OPERATION', dataIndex: 'edit', width: 200 },\r\n  ];\r\n\r\n  type Author = {\r\n    name?: string;\r\n    email?: string;\r\n    avatar?: string;\r\n    department?: string;\r\n    jobs?: string;\r\n    position?: string[];\r\n    role?: string;\r\n    status?: number;\r\n    time?: Dayjs;\r\n    _edit?: boolean;\r\n    _isNew?: boolean;\r\n  };\r\n\r\n  const authors = reactive<Author[]>([\r\n    {\r\n      name: 'Li Zhi',\r\n      email: '1126263215@qq.com',\r\n      avatar: '/src/assets/avatar/face-1.jpg',\r\n      jobs: 'developer',\r\n      department: 'Technical',\r\n      status: 1,\r\n      time: dayjs(),\r\n    },\r\n    {\r\n      name: 'Li Zhi',\r\n      email: '1126263215@qq.com',\r\n      avatar: '/src/assets/avatar/face-2.jpg',\r\n      jobs: 'developer',\r\n      department: 'Technical',\r\n      status: 0,\r\n      time: dayjs(),\r\n    },\r\n    {\r\n      name: 'Li Zhi',\r\n      email: '1126263215@qq.com',\r\n      avatar: '/src/assets/avatar/face-3.jpg',\r\n      jobs: 'developer',\r\n      department: 'Technical',\r\n      status: 1,\r\n      time: dayjs(),\r\n    },\r\n    {\r\n      name: 'Li Zhi',\r\n      email: '1126263215@qq.com',\r\n      avatar: '/src/assets/avatar/face-4.jpg',\r\n      jobs: 'developer',\r\n      department: 'Technical',\r\n      status: 0,\r\n      time: dayjs(),\r\n    },\r\n  ]);\r\n\r\n  function addNew() {\r\n    showModal.value = true;\r\n    form._isNew = true;\r\n  }\r\n\r\n  const showModal = ref(false);\r\n\r\n  const newAuthor = (author?: Author) => {\r\n    if (!author) {\r\n      author = { _isNew: true };\r\n    }\r\n    author.name = undefined;\r\n    author.email = undefined;\r\n    author.avatar = undefined;\r\n    author.position = [];\r\n    author.department = undefined;\r\n    author.jobs = undefined;\r\n    author.status = 0;\r\n    author.time = dayjs();\r\n    return author;\r\n  };\r\n\r\n  const copyObject = (target: any, source?: any) => {\r\n    if (!source) {\r\n      return target;\r\n    }\r\n    Object.keys(target).forEach((key) => (target[key] = source[key]));\r\n  };\r\n\r\n  const form = reactive<Author>(newAuthor());\r\n\r\n  function reset() {\r\n    return newAuthor(form);\r\n  }\r\n\r\n  function cancel() {\r\n    showModal.value = false;\r\n    reset();\r\n  }\r\n\r\n  const formModel = ref<FormInstance>();\r\n\r\n  const formLoading = ref(false);\r\n\r\n  async function extractImg(file: Blob, author: Author) {\r\n    await getBase64(file).then((res) => {\r\n      author.avatar = res;\r\n    });\r\n  }\r\n\r\n  function submit() {\r\n    formLoading.value = true;\r\n    formModel.value\r\n      ?.validateFields()\r\n      .then((res: Author) => {\r\n        res.department = res?.position?.[0];\r\n        res.jobs = res?.position?.[1];\r\n        if (form._isNew) {\r\n          authors.push({ ...res });\r\n        } else {\r\n          copyObject(editRecord.value, res);\r\n        }\r\n        showModal.value = false;\r\n        reset();\r\n      })\r\n      .catch((e) => {\r\n        console.error(e);\r\n      })\r\n      .finally(() => {\r\n        formLoading.value = false;\r\n      });\r\n  }\r\n\r\n  const editRecord = ref<Author>();\r\n\r\n  /**\r\n   * 编辑\r\n   * @param record\r\n   */\r\n  function edit(record: Author) {\r\n    editRecord.value = record;\r\n    copyObject(form, record);\r\n    form.position = [form.department!, form.jobs!];\r\n    showModal.value = true;\r\n  }\r\n\r\n  type Status = 0 | 1;\r\n\r\n  const StatusDict = {\r\n    0: 'offline',\r\n    1: 'online',\r\n  };\r\n</script>\r\n<template>\r\n  <a-modal :title=\"form._isNew ? '新增作者' : '编辑作者'\" v-model:visible=\"showModal\" @ok=\"submit\" @cancel=\"cancel\">\r\n    <a-form ref=\"formModel\" :model=\"form\" :labelCol=\"{ span: 5 }\" :wrapperCol=\"{ span: 16 }\">\r\n      <a-form-item label=\"头像\" required name=\"avatar\">\r\n        <a-upload :show-upload-list=\"false\" :beforeUpload=\"(file: File) => extractImg(file, form)\">\r\n          <img class=\"h-8 p-0.5 rounded border border-dashed border-border\" v-if=\"form.avatar\" :src=\"form.avatar\" />\r\n          <a-button v-else type=\"dashed\">\r\n            <template #icon>\r\n              <UploadOutlined />\r\n            </template>\r\n            上传\r\n          </a-button>\r\n        </a-upload>\r\n      </a-form-item>\r\n      <a-form-item label=\"姓名\" required name=\"name\">\r\n        <a-input v-model:value=\"form.name\" />\r\n      </a-form-item>\r\n      <a-form-item required label=\"邮箱\" name=\"email\">\r\n        <a-input v-model:value=\"form.email\" />\r\n      </a-form-item>\r\n      <a-form-item required label=\"岗位\" name=\"position\">\r\n        <a-cascader\r\n          v-model:value=\"form.position\"\r\n          :options=\"[\r\n            {\r\n              label: 'IT部',\r\n              value: 'IT部',\r\n              children: [\r\n                {\r\n                  label: '前端开发',\r\n                  value: '前端开发',\r\n                },\r\n                {\r\n                  label: '后端开发',\r\n                  value: '后端开发',\r\n                },\r\n                {\r\n                  label: 'UI设计师',\r\n                  value: 'UI设计师',\r\n                },\r\n              ],\r\n            },\r\n          ]\"\r\n        />\r\n      </a-form-item>\r\n      <a-form-item required label=\"状态\" name=\"status\">\r\n        <a-select\r\n          style=\"width: 90px\"\r\n          v-model:value=\"form.status\"\r\n          :options=\"[\r\n            { label: 'offline', value: 0 },\r\n            { label: 'online', value: 1 },\r\n          ]\"\r\n        />\r\n      </a-form-item>\r\n      <a-form-item label=\"日期\" name=\"time\">\r\n        <a-date-picker v-model:value=\"form.time\" />\r\n      </a-form-item>\r\n    </a-form>\r\n  </a-modal>\r\n\r\n  <!-- 成员表格 -->\r\n  <a-table v-bind=\"$attrs\" :columns=\"columns\" :dataSource=\"authors\" :pagination=\"false\">\r\n    <template #title>\r\n      <div class=\"flex justify-between pr-4\">\r\n        <h4>成员表格</h4>\r\n        <a-button type=\"primary\" @click=\"addNew\" :loading=\"formLoading\">\r\n          <template #icon>\r\n            <PlusOutlined />\r\n          </template>\r\n          新增\r\n        </a-button>\r\n      </div>\r\n    </template>\r\n    <template #bodyCell=\"{ column, text, record }\">\r\n      <div class=\"flex items-stretch\" v-if=\"column.dataIndex === 'name'\">\r\n        <img class=\"w-12 rounded\" :src=\"record.avatar\" />\r\n        <div class=\"flex-col flex justify-evenly ml-2\">\r\n          <span class=\"text-title font-bold\">{{ text }}</span>\r\n          <span class=\"text-xs text-subtext\">{{ record.email }}</span>\r\n        </div>\r\n      </div>\r\n      <div class=\"\" v-else-if=\"column.dataIndex === 'position'\">\r\n        <div class=\"text-title font-bold\">\r\n          {{ record.jobs }}\r\n        </div>\r\n        <div class=\"text-subtext\">\r\n          {{ record.department }}\r\n        </div>\r\n      </div>\r\n      <template v-else-if=\"column.dataIndex === 'status'\">\r\n        <a-badge class=\"text-subtext\" :color=\"'green'\">\r\n          <template #text>\r\n            <span class=\"text-subtext\">{{ StatusDict[text as Status] }}</span>\r\n          </template>\r\n        </a-badge>\r\n      </template>\r\n      <template v-else-if=\"column.dataIndex === 'time'\">\r\n        {{ text?.format('YYYY-MM-DD') }}\r\n      </template>\r\n      <template v-else-if=\"column.dataIndex === 'edit'\">\r\n        <a-button :disabled=\"showModal\" type=\"link\" @click=\"edit(record)\">\r\n          <template #icon>\r\n            <EditFilled />\r\n          </template>\r\n          编辑\r\n        </a-button>\r\n      </template>\r\n      <div v-else class=\"text-subtext\">\r\n        {{ text }}\r\n      </div>\r\n    </template>\r\n  </a-table>\r\n</template>\r\n"],"names":["columns","authors","reactive","dayjs","addNew","showModal","form","ref","newAuthor","author","copyObject","target","source","key","reset","cancel","formModel","formLoading","extractImg","file","getBase64","res","submit","_a","_b","editRecord","edit","record","StatusDict"],"mappings":"g0BAQE,MAAAA,EAAA,CAAgB,CACd,MAAA,SACS,UAAA,MACI,EACb,CAAA,MAAA,WAAA,UAAA,UAAA,EAC2C,CAAA,MAAA,SAAA,UAAA,QAAA,EACJ,CAAA,MAAA,WAAA,UAAA,MAAA,EACA,CAAA,MAAA,YAAA,UAAA,OAAA,MAAA,GAAA,CACa,EAiBtDC,EAAAC,EAAA,CAAmC,CACjC,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAC,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,EACd,CACA,KAAA,SACQ,MAAA,oBACC,OAAA,gCACC,KAAA,YACF,WAAA,YACM,OAAA,EACJ,KAAAA,EAAA,CACI,CACd,CAAA,EAGF,SAAAC,GAAA,CACEC,EAAA,MAAA,GACAC,EAAA,OAAA,EAAc,CAGhB,MAAAD,EAAAE,EAAA,EAAA,EAEAC,EAAAC,IACEA,IACEA,EAAA,CAAA,OAAA,KAEFA,EAAA,KAAA,OACAA,EAAA,MAAA,OACAA,EAAA,OAAA,OACAA,EAAA,SAAA,GACAA,EAAA,WAAA,OACAA,EAAA,KAAA,OACAA,EAAA,OAAA,EACAA,EAAA,KAAAN,IACAM,GAGFC,EAAA,CAAAC,EAAAC,IAAA,CACE,GAAA,CAAAA,EACE,OAAAD,EAEF,OAAA,KAAAA,CAAA,EAAA,QAAAE,GAAAF,EAAAE,CAAA,EAAAD,EAAAC,CAAA,CAAA,CAAgE,EAGlEP,EAAAJ,EAAAM,EAAA,CAAA,EAEA,SAAAM,GAAA,CACE,OAAAN,EAAAF,CAAA,CAAqB,CAGvB,SAAAS,GAAA,CACEV,EAAA,MAAA,GACAS,GAAM,CAGR,MAAAE,EAAAT,IAEAU,EAAAV,EAAA,EAAA,EAEA,eAAAW,EAAAC,EAAAV,EAAA,CACE,MAAAW,GAAAD,CAAA,EAAA,KAAAE,GAAA,CACEZ,EAAA,OAAAY,CAAgB,CAAA,CACjB,CAGH,SAAAC,GAAA,OACEL,EAAA,MAAA,IACAM,EAAAP,EAAA,QAAA,MAAAO,EAAA,iBAAA,KAAAF,GAAA,SAGIA,EAAA,YAAAE,EAAAF,GAAA,YAAAA,EAAA,WAAA,YAAAE,EAAA,GACAF,EAAA,MAAAG,EAAAH,GAAA,YAAAA,EAAA,WAAA,YAAAG,EAAA,GACAlB,EAAA,OACEL,EAAA,KAAA,CAAA,GAAAoB,CAAA,CAAA,EAEAX,EAAAe,EAAA,MAAAJ,CAAA,EAEFhB,EAAA,MAAA,GACAS,GAAM,GAAA,MAAA,GAAA,CAGN,QAAA,MAAA,CAAA,CAAe,GAAA,QAAA,IAAA,CAGfG,EAAA,MAAA,EAAoB,EACrB,CAGL,MAAAQ,EAAAlB,IAMA,SAAAmB,EAAAC,EAAA,CACEF,EAAA,MAAAE,EACAjB,EAAAJ,EAAAqB,CAAA,EACArB,EAAA,SAAA,CAAAA,EAAA,WAAAA,EAAA,IAAA,EACAD,EAAA,MAAA,EAAkB,CAKpB,MAAAuB,EAAA,CAAmB,EAAA,UACd,EAAA,QACA"}