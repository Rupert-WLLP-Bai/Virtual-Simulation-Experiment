{"version":3,"file":"index-920ed813.js","sources":["../../src/pages/exp6/JUECESHU/index.vue","../../src/pages/exp6/JUECESHU/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <p>Notice：改动表一将清空表三的数据，修改表四的数据！</p>\r\n    <EditableForm1 :dataSource=\"dataSource1\" :columns=\"columns1\" @updateData=\"handleDataSource1Update\"\r\n      >一、基础经济数据表</EditableForm1\r\n    >\r\n    <HorizontalTree :dataSource=\"dataSource1\"></HorizontalTree>\r\n\r\n    <EditableForm2 :dataSource=\"dataSource2\" :columns=\"columns2\" @updateData=\"handleDataSource2Update\"\r\n      >二、现值和净现值序列决策树图</EditableForm2\r\n    >\r\n    <HorizontalTree :dataSource=\"dataSource2\"></HorizontalTree>\r\n\r\n    <EditableForm2 :dataSource=\"dataSource3\" :columns=\"columns3\" @updateData=\"handleDataSource3Update\"\r\n      >三、净现值计算表格</EditableForm2\r\n    >\r\n\r\n    <EditableForm2 :dataSource=\"dataSource4\" :columns=\"columns4\" @updateData=\"handleDataSource4Update\"\r\n      >四、净现值计算表格（参考）</EditableForm2\r\n    >\r\n\r\n    <EditableForm1 :dataSource=\"dataSource5\" :columns=\"columns5\" @updateData=\"handleDataSource5Update\"\r\n      >五、净现值与其累计概率表</EditableForm1\r\n    >\r\n\r\n    <div>\r\n      本项目的期望净现值(ENPV)为 <a-input v-model:value=\"enpv\" allowClear style=\"width: 10%\"></a-input>万元，\r\n      但是存在净现值小于零的可能性为 <a-input v-model:value=\"risk\" allowClear style=\"width: 10%\"></a-input>%的风险。\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n  import { Table } from 'ant-design-vue';\r\n  import HorizontalTree from '@/pages/exp6/JUECESHU/HorizontalTree.vue';\r\n  import EditableForm1 from '@/pages/exp6/JUECESHU/EditableForm1.vue';\r\n  import EditableForm2 from '@/pages/exp6/JUECESHU/EditableForm2.vue';\r\n  export default {\r\n    components: {\r\n      'a-table': Table,\r\n      HorizontalTree,\r\n      EditableForm1,\r\n      EditableForm2,\r\n    },\r\n    data() {\r\n      return {\r\n        enpv: 0,\r\n        risk: 0,\r\n        discountRate: 0.08, // 折现率\r\n        dataSource1: [\r\n          {\r\n            key: '0',\r\n            uncertainty: '投资',\r\n            value: 3500,\r\n            probability: 0.15,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '1',\r\n            uncertainty: '投资',\r\n            value: 3300,\r\n            probability: 0.7,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '2',\r\n            uncertainty: '投资',\r\n            value: 3000,\r\n            probability: 0.15,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '3',\r\n            uncertainty: '年经营成本',\r\n            value: 1100,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '4',\r\n            uncertainty: '年经营成本',\r\n            value: 1000,\r\n            probability: 0.4,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '5',\r\n            uncertainty: '年经营成本',\r\n            value: 900,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '6',\r\n            uncertainty: '年销售收入',\r\n            value: 3300,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '7',\r\n            uncertainty: '年销售收入',\r\n            value: 3000,\r\n            probability: 0.5,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '8',\r\n            uncertainty: '年销售收入',\r\n            value: 2700,\r\n            probability: 0.2,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n        ],\r\n        columns1: [\r\n          {\r\n            title: '不确定因素',\r\n            dataIndex: 'uncertainty',\r\n            slots: {\r\n              customRender: 'uncertainty',\r\n            },\r\n          },\r\n          {\r\n            title: '取值（万元）',\r\n            dataIndex: 'value',\r\n            slots: {\r\n              customRender: 'value',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '开始年份',\r\n            dataIndex: 'start_year',\r\n            slots: {\r\n              customRender: 'start_year',\r\n            },\r\n          },\r\n          {\r\n            title: '结束年份',\r\n            dataIndex: 'end_year',\r\n            slots: {\r\n              customRender: 'end_year',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource2: [\r\n          {\r\n            key: '0',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.15,\r\n          },\r\n          {\r\n            key: '1',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.7,\r\n          },\r\n          {\r\n            key: '2',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.15,\r\n          },\r\n          {\r\n            key: '3',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '4',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.4,\r\n          },\r\n          {\r\n            key: '5',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '6',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '7',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.5,\r\n          },\r\n          {\r\n            key: '8',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.2,\r\n          },\r\n        ],\r\n        columns2: [\r\n          {\r\n            title: '不确定因素',\r\n            dataIndex: 'uncertainty',\r\n            slots: {\r\n              customRender: 'uncertainty',\r\n            },\r\n          },\r\n          {\r\n            title: '现值（万元）',\r\n            dataIndex: 'value',\r\n            slots: {\r\n              customRender: 'value',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource3: [],\r\n        columns3: [\r\n          {\r\n            title: '净现值（万元）',\r\n            dataIndex: 'netValue',\r\n            slots: {\r\n              customRender: 'netValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '加权净现值',\r\n            dataIndex: 'weightedNetPresentValue',\r\n            slots: {\r\n              customRender: 'weightedNetPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource4: [],\r\n        columns4: [\r\n          {\r\n            title: '投资现值',\r\n            dataIndex: 'investmentPresentValue',\r\n            slots: {\r\n              customRender: 'investmentPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '投资概率',\r\n            dataIndex: 'investmentProbability',\r\n            slots: {\r\n              customRender: 'investmentProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '年成本现值',\r\n            dataIndex: 'annualCostPresentValue',\r\n            slots: {\r\n              customRender: 'annualCostPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '成本概率',\r\n            dataIndex: 'costProbability',\r\n            slots: {\r\n              customRender: 'costProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '年收入现值',\r\n            dataIndex: 'annualRevenuePresentValue',\r\n            slots: {\r\n              customRender: 'annualRevenuePresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '收入概率',\r\n            dataIndex: 'revenueProbability',\r\n            slots: {\r\n              customRender: 'revenueProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '期望净现值',\r\n            dataIndex: 'expectedNetPresentValue',\r\n            slots: {\r\n              customRender: 'expectedNetPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n        ],\r\n        dataSource5: [\r\n          {\r\n            key: '0',\r\n            netValue: -1116,\r\n            probability: 0.05,\r\n            cumulativeProbability: 0.05,\r\n          },\r\n        ],\r\n        columns5: [\r\n          {\r\n            title: '净现值',\r\n            dataIndex: 'netValue',\r\n            slots: {\r\n              customRender: 'netValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '累计概率',\r\n            dataIndex: 'cumulativeProbability',\r\n            slots: {\r\n              customRender: 'cumulativeProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n      };\r\n    },\r\n    mounted() {\r\n      this.calculateDataSource3();\r\n      this.calculateDataSource4();\r\n    },\r\n    methods: {\r\n      presentValueOfAnnuity(A, i, n) {\r\n        const P_A = (1 - Math.pow(1 + i, -n)) / i;\r\n        const P = A * P_A;\r\n        return P;\r\n      },\r\n      presentValueOfFutureValue(F, i, n) {\r\n        const P_F = 1 / Math.pow(1 + i, n);\r\n        const P = F * P_F;\r\n        return P;\r\n      },\r\n      calculateDataSource3() {\r\n        const levels = {};\r\n        // 将具有相同uncertainty的项分组到一起\r\n        for (const item of this.dataSource1) {\r\n          if (!levels[item.uncertainty]) {\r\n            levels[item.uncertainty] = [];\r\n          }\r\n          levels[item.uncertainty].push(item);\r\n        }\r\n        // 遍历uncertainty层次，构建树结构\r\n        const keys = Object.keys(levels);\r\n        let tableLength = 1;\r\n        for (let i = 0; i < keys.length; i++) {\r\n          tableLength *= levels[keys[i]].length;\r\n        }\r\n        for (let i = 0; i < tableLength; i++) {\r\n          this.dataSource3.push({\r\n            netValue: undefined,\r\n            probability: undefined,\r\n            weightedNetPresentValue: undefined,\r\n          });\r\n        }\r\n      },\r\n      calculateDataSource4() {\r\n        // this.dataSource4 = [];\r\n        while (this.dataSource4.length) {\r\n          this.dataSource4.pop();\r\n        }\r\n\r\n        const investmentPresentValue = this.dataSource1.filter((item) => item.uncertainty === '投资');\r\n        const annualCostPresentValue = this.dataSource1.filter((item) => item.uncertainty === '年经营成本');\r\n        const annualRevenuePresentValue = this.dataSource1.filter((item) => item.uncertainty === '年销售收入');\r\n\r\n        for (let i = 0; i < investmentPresentValue.length; i++) {\r\n          for (let j = 0; j < annualCostPresentValue.length; j++) {\r\n            for (let k = 0; k < annualRevenuePresentValue.length; k++) {\r\n              let cost = this.presentValueOfFutureValue(\r\n                this.presentValueOfAnnuity(\r\n                  annualCostPresentValue[j].value,\r\n                  this.discountRate,\r\n                  annualCostPresentValue[i].end_year - annualCostPresentValue[i].start_year + 1\r\n                ),\r\n                this.discountRate,\r\n                investmentPresentValue[i].end_year - investmentPresentValue[i].start_year\r\n              );\r\n              let revenue = this.presentValueOfFutureValue(\r\n                this.presentValueOfAnnuity(\r\n                  annualRevenuePresentValue[j].value,\r\n                  this.discountRate,\r\n                  annualRevenuePresentValue[i].end_year - annualRevenuePresentValue[i].start_year + 1\r\n                ),\r\n                this.discountRate,\r\n                investmentPresentValue[i].end_year - investmentPresentValue[i].start_year\r\n              );\r\n              this.dataSource4.push({\r\n                investmentPresentValue: investmentPresentValue[i].value,\r\n                investmentProbability: investmentPresentValue[i].probability,\r\n                annualCostPresentValue: cost.toFixed(2),\r\n                costProbability: annualCostPresentValue[j].probability,\r\n                annualRevenuePresentValue: revenue.toFixed(2),\r\n                revenueProbability: annualRevenuePresentValue[k].probability,\r\n                expectedNetPresentValue: (\r\n                  revenue * annualRevenuePresentValue[k].probability -\r\n                  cost * annualCostPresentValue[j].probability -\r\n                  investmentPresentValue[i].value * investmentPresentValue[i].probability\r\n                ).toFixed(2),\r\n                probability: (\r\n                  investmentPresentValue[i].probability *\r\n                  annualCostPresentValue[j].probability *\r\n                  annualRevenuePresentValue[k].probability\r\n                ).toFixed(2),\r\n              });\r\n            }\r\n          }\r\n        }\r\n        console.log(this.dataSource4);\r\n      },\r\n      handleDataSource1Update(newData) {\r\n        console.log('parent watch dataSource1 change');\r\n        this.dataSource1 = newData;\r\n\r\n        this.calculateDataSource3();\r\n        this.calculateDataSource4();\r\n      },\r\n      handleDataSource2Update(newData) {\r\n        console.log('parent watch dataSource2 change');\r\n        this.dataSource2 = newData;\r\n      },\r\n      handleDataSource3Update(newData) {\r\n        console.log('parent watch dataSource3 change');\r\n        this.dataSource3 = newData;\r\n      },\r\n      handleDataSource4Update(newData) {\r\n        console.log('parent watch dataSource4 change');\r\n        this.dataSource4 = newData;\r\n      },\r\n      handleDataSource5Update(newData) {\r\n        console.log('parent watch dataSource5 change');\r\n        this.dataSource5 = newData;\r\n      },\r\n    },\r\n  };\r\n</script>\r\n","<template>\r\n  <div class=\"container\">\r\n    <p>Notice：改动表一将清空表三的数据，修改表四的数据！</p>\r\n    <EditableForm1 :dataSource=\"dataSource1\" :columns=\"columns1\" @updateData=\"handleDataSource1Update\"\r\n      >一、基础经济数据表</EditableForm1\r\n    >\r\n    <HorizontalTree :dataSource=\"dataSource1\"></HorizontalTree>\r\n\r\n    <EditableForm2 :dataSource=\"dataSource2\" :columns=\"columns2\" @updateData=\"handleDataSource2Update\"\r\n      >二、现值和净现值序列决策树图</EditableForm2\r\n    >\r\n    <HorizontalTree :dataSource=\"dataSource2\"></HorizontalTree>\r\n\r\n    <EditableForm2 :dataSource=\"dataSource3\" :columns=\"columns3\" @updateData=\"handleDataSource3Update\"\r\n      >三、净现值计算表格</EditableForm2\r\n    >\r\n\r\n    <EditableForm2 :dataSource=\"dataSource4\" :columns=\"columns4\" @updateData=\"handleDataSource4Update\"\r\n      >四、净现值计算表格（参考）</EditableForm2\r\n    >\r\n\r\n    <EditableForm1 :dataSource=\"dataSource5\" :columns=\"columns5\" @updateData=\"handleDataSource5Update\"\r\n      >五、净现值与其累计概率表</EditableForm1\r\n    >\r\n\r\n    <div>\r\n      本项目的期望净现值(ENPV)为 <a-input v-model:value=\"enpv\" allowClear style=\"width: 10%\"></a-input>万元，\r\n      但是存在净现值小于零的可能性为 <a-input v-model:value=\"risk\" allowClear style=\"width: 10%\"></a-input>%的风险。\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n  import { Table } from 'ant-design-vue';\r\n  import HorizontalTree from '@/pages/exp6/JUECESHU/HorizontalTree.vue';\r\n  import EditableForm1 from '@/pages/exp6/JUECESHU/EditableForm1.vue';\r\n  import EditableForm2 from '@/pages/exp6/JUECESHU/EditableForm2.vue';\r\n  export default {\r\n    components: {\r\n      'a-table': Table,\r\n      HorizontalTree,\r\n      EditableForm1,\r\n      EditableForm2,\r\n    },\r\n    data() {\r\n      return {\r\n        enpv: 0,\r\n        risk: 0,\r\n        discountRate: 0.08, // 折现率\r\n        dataSource1: [\r\n          {\r\n            key: '0',\r\n            uncertainty: '投资',\r\n            value: 3500,\r\n            probability: 0.15,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '1',\r\n            uncertainty: '投资',\r\n            value: 3300,\r\n            probability: 0.7,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '2',\r\n            uncertainty: '投资',\r\n            value: 3000,\r\n            probability: 0.15,\r\n            start_year: 1,\r\n            end_year: 3,\r\n          },\r\n          {\r\n            key: '3',\r\n            uncertainty: '年经营成本',\r\n            value: 1100,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '4',\r\n            uncertainty: '年经营成本',\r\n            value: 1000,\r\n            probability: 0.4,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '5',\r\n            uncertainty: '年经营成本',\r\n            value: 900,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '6',\r\n            uncertainty: '年销售收入',\r\n            value: 3300,\r\n            probability: 0.3,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '7',\r\n            uncertainty: '年销售收入',\r\n            value: 3000,\r\n            probability: 0.5,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n          {\r\n            key: '8',\r\n            uncertainty: '年销售收入',\r\n            value: 2700,\r\n            probability: 0.2,\r\n            start_year: 4,\r\n            end_year: 13,\r\n          },\r\n        ],\r\n        columns1: [\r\n          {\r\n            title: '不确定因素',\r\n            dataIndex: 'uncertainty',\r\n            slots: {\r\n              customRender: 'uncertainty',\r\n            },\r\n          },\r\n          {\r\n            title: '取值（万元）',\r\n            dataIndex: 'value',\r\n            slots: {\r\n              customRender: 'value',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '开始年份',\r\n            dataIndex: 'start_year',\r\n            slots: {\r\n              customRender: 'start_year',\r\n            },\r\n          },\r\n          {\r\n            title: '结束年份',\r\n            dataIndex: 'end_year',\r\n            slots: {\r\n              customRender: 'end_year',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource2: [\r\n          {\r\n            key: '0',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.15,\r\n          },\r\n          {\r\n            key: '1',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.7,\r\n          },\r\n          {\r\n            key: '2',\r\n            uncertainty: '投资',\r\n            value: undefined,\r\n            probability: 0.15,\r\n          },\r\n          {\r\n            key: '3',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '4',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.4,\r\n          },\r\n          {\r\n            key: '5',\r\n            uncertainty: '年经营成本',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '6',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.3,\r\n          },\r\n          {\r\n            key: '7',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.5,\r\n          },\r\n          {\r\n            key: '8',\r\n            uncertainty: '年销售收入',\r\n            value: undefined,\r\n            probability: 0.2,\r\n          },\r\n        ],\r\n        columns2: [\r\n          {\r\n            title: '不确定因素',\r\n            dataIndex: 'uncertainty',\r\n            slots: {\r\n              customRender: 'uncertainty',\r\n            },\r\n          },\r\n          {\r\n            title: '现值（万元）',\r\n            dataIndex: 'value',\r\n            slots: {\r\n              customRender: 'value',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource3: [],\r\n        columns3: [\r\n          {\r\n            title: '净现值（万元）',\r\n            dataIndex: 'netValue',\r\n            slots: {\r\n              customRender: 'netValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '加权净现值',\r\n            dataIndex: 'weightedNetPresentValue',\r\n            slots: {\r\n              customRender: 'weightedNetPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n        dataSource4: [],\r\n        columns4: [\r\n          {\r\n            title: '投资现值',\r\n            dataIndex: 'investmentPresentValue',\r\n            slots: {\r\n              customRender: 'investmentPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '投资概率',\r\n            dataIndex: 'investmentProbability',\r\n            slots: {\r\n              customRender: 'investmentProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '年成本现值',\r\n            dataIndex: 'annualCostPresentValue',\r\n            slots: {\r\n              customRender: 'annualCostPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '成本概率',\r\n            dataIndex: 'costProbability',\r\n            slots: {\r\n              customRender: 'costProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '年收入现值',\r\n            dataIndex: 'annualRevenuePresentValue',\r\n            slots: {\r\n              customRender: 'annualRevenuePresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '收入概率',\r\n            dataIndex: 'revenueProbability',\r\n            slots: {\r\n              customRender: 'revenueProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '期望净现值',\r\n            dataIndex: 'expectedNetPresentValue',\r\n            slots: {\r\n              customRender: 'expectedNetPresentValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n        ],\r\n        dataSource5: [\r\n          {\r\n            key: '0',\r\n            netValue: -1116,\r\n            probability: 0.05,\r\n            cumulativeProbability: 0.05,\r\n          },\r\n        ],\r\n        columns5: [\r\n          {\r\n            title: '净现值',\r\n            dataIndex: 'netValue',\r\n            slots: {\r\n              customRender: 'netValue',\r\n            },\r\n          },\r\n          {\r\n            title: '概率',\r\n            dataIndex: 'probability',\r\n            slots: {\r\n              customRender: 'probability',\r\n            },\r\n          },\r\n          {\r\n            title: '累计概率',\r\n            dataIndex: 'cumulativeProbability',\r\n            slots: {\r\n              customRender: 'cumulativeProbability',\r\n            },\r\n          },\r\n          {\r\n            title: '操作',\r\n            dataIndex: 'operation',\r\n            slots: {\r\n              customRender: 'operation',\r\n            },\r\n          },\r\n        ],\r\n      };\r\n    },\r\n    mounted() {\r\n      this.calculateDataSource3();\r\n      this.calculateDataSource4();\r\n    },\r\n    methods: {\r\n      presentValueOfAnnuity(A, i, n) {\r\n        const P_A = (1 - Math.pow(1 + i, -n)) / i;\r\n        const P = A * P_A;\r\n        return P;\r\n      },\r\n      presentValueOfFutureValue(F, i, n) {\r\n        const P_F = 1 / Math.pow(1 + i, n);\r\n        const P = F * P_F;\r\n        return P;\r\n      },\r\n      calculateDataSource3() {\r\n        const levels = {};\r\n        // 将具有相同uncertainty的项分组到一起\r\n        for (const item of this.dataSource1) {\r\n          if (!levels[item.uncertainty]) {\r\n            levels[item.uncertainty] = [];\r\n          }\r\n          levels[item.uncertainty].push(item);\r\n        }\r\n        // 遍历uncertainty层次，构建树结构\r\n        const keys = Object.keys(levels);\r\n        let tableLength = 1;\r\n        for (let i = 0; i < keys.length; i++) {\r\n          tableLength *= levels[keys[i]].length;\r\n        }\r\n        for (let i = 0; i < tableLength; i++) {\r\n          this.dataSource3.push({\r\n            netValue: undefined,\r\n            probability: undefined,\r\n            weightedNetPresentValue: undefined,\r\n          });\r\n        }\r\n      },\r\n      calculateDataSource4() {\r\n        // this.dataSource4 = [];\r\n        while (this.dataSource4.length) {\r\n          this.dataSource4.pop();\r\n        }\r\n\r\n        const investmentPresentValue = this.dataSource1.filter((item) => item.uncertainty === '投资');\r\n        const annualCostPresentValue = this.dataSource1.filter((item) => item.uncertainty === '年经营成本');\r\n        const annualRevenuePresentValue = this.dataSource1.filter((item) => item.uncertainty === '年销售收入');\r\n\r\n        for (let i = 0; i < investmentPresentValue.length; i++) {\r\n          for (let j = 0; j < annualCostPresentValue.length; j++) {\r\n            for (let k = 0; k < annualRevenuePresentValue.length; k++) {\r\n              let cost = this.presentValueOfFutureValue(\r\n                this.presentValueOfAnnuity(\r\n                  annualCostPresentValue[j].value,\r\n                  this.discountRate,\r\n                  annualCostPresentValue[i].end_year - annualCostPresentValue[i].start_year + 1\r\n                ),\r\n                this.discountRate,\r\n                investmentPresentValue[i].end_year - investmentPresentValue[i].start_year\r\n              );\r\n              let revenue = this.presentValueOfFutureValue(\r\n                this.presentValueOfAnnuity(\r\n                  annualRevenuePresentValue[j].value,\r\n                  this.discountRate,\r\n                  annualRevenuePresentValue[i].end_year - annualRevenuePresentValue[i].start_year + 1\r\n                ),\r\n                this.discountRate,\r\n                investmentPresentValue[i].end_year - investmentPresentValue[i].start_year\r\n              );\r\n              this.dataSource4.push({\r\n                investmentPresentValue: investmentPresentValue[i].value,\r\n                investmentProbability: investmentPresentValue[i].probability,\r\n                annualCostPresentValue: cost.toFixed(2),\r\n                costProbability: annualCostPresentValue[j].probability,\r\n                annualRevenuePresentValue: revenue.toFixed(2),\r\n                revenueProbability: annualRevenuePresentValue[k].probability,\r\n                expectedNetPresentValue: (\r\n                  revenue * annualRevenuePresentValue[k].probability -\r\n                  cost * annualCostPresentValue[j].probability -\r\n                  investmentPresentValue[i].value * investmentPresentValue[i].probability\r\n                ).toFixed(2),\r\n                probability: (\r\n                  investmentPresentValue[i].probability *\r\n                  annualCostPresentValue[j].probability *\r\n                  annualRevenuePresentValue[k].probability\r\n                ).toFixed(2),\r\n              });\r\n            }\r\n          }\r\n        }\r\n        console.log(this.dataSource4);\r\n      },\r\n      handleDataSource1Update(newData) {\r\n        console.log('parent watch dataSource1 change');\r\n        this.dataSource1 = newData;\r\n\r\n        this.calculateDataSource3();\r\n        this.calculateDataSource4();\r\n      },\r\n      handleDataSource2Update(newData) {\r\n        console.log('parent watch dataSource2 change');\r\n        this.dataSource2 = newData;\r\n      },\r\n      handleDataSource3Update(newData) {\r\n        console.log('parent watch dataSource3 change');\r\n        this.dataSource3 = newData;\r\n      },\r\n      handleDataSource4Update(newData) {\r\n        console.log('parent watch dataSource4 change');\r\n        this.dataSource4 = newData;\r\n      },\r\n      handleDataSource5Update(newData) {\r\n        console.log('parent watch dataSource5 change');\r\n        this.dataSource5 = newData;\r\n      },\r\n    },\r\n  };\r\n</script>\r\n"],"names":["_sfc_main","Table","HorizontalTree","EditableForm1","EditableForm2","A","i","n","P_A","F","P_F","levels","item","keys","tableLength","investmentPresentValue","annualCostPresentValue","annualRevenuePresentValue","j","k","cost","revenue","newData","_component_a_input","__unplugin_components_0","_hoisted_2","$data","$options","_createVNode","_component_HorizontalTree","_component_EditableForm2","_component_EditableForm1","_createElementVNode","_createTextVNode","_cache","$event"],"mappings":"0YAqCE,MAAAA,EAAA,CAAe,WAAA,CACD,UAAAC,EACC,eAAAC,EACX,cAAAC,EACA,cAAAC,CACA,EACF,MAAA,CAEE,MAAA,CAAO,KAAA,EACC,KAAA,EACA,aAAA,IACQ,YAAA,CACD,CACX,IAAA,IACO,YAAA,KACQ,MAAA,KACN,YAAA,IACM,WAAA,EACD,SAAA,CACF,EACZ,CACA,IAAA,IACO,YAAA,KACQ,MAAA,KACN,YAAA,GACM,WAAA,EACD,SAAA,CACF,EACZ,CACA,IAAA,IACO,YAAA,KACQ,MAAA,IACN,YAAA,IACM,WAAA,EACD,SAAA,CACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,KACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,IACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,IACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,KACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,IACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,EACZ,CACA,IAAA,IACO,YAAA,QACQ,MAAA,KACN,YAAA,GACM,WAAA,EACD,SAAA,EACF,CACZ,EACF,SAAA,CACU,CACR,MAAA,QACS,UAAA,cACI,MAAA,CACJ,aAAA,aACS,CAChB,EACF,CACA,MAAA,SACS,UAAA,QACI,MAAA,CACJ,aAAA,OACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,cACI,MAAA,CACJ,aAAA,aACS,CAChB,EACF,CACA,MAAA,OACS,UAAA,aACI,MAAA,CACJ,aAAA,YACS,CAChB,EACF,CACA,MAAA,OACS,UAAA,WACI,MAAA,CACJ,aAAA,UACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,YACI,MAAA,CACJ,aAAA,WACS,CAChB,CACF,EACF,YAAA,CACa,CACX,IAAA,IACO,YAAA,KACQ,MAAA,OACN,YAAA,GACM,EACf,CACA,IAAA,IACO,YAAA,KACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,KACQ,MAAA,OACN,YAAA,GACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,EACf,CACA,IAAA,IACO,YAAA,QACQ,MAAA,OACN,YAAA,EACM,CACf,EACF,SAAA,CACU,CACR,MAAA,QACS,UAAA,cACI,MAAA,CACJ,aAAA,aACS,CAChB,EACF,CACA,MAAA,SACS,UAAA,QACI,MAAA,CACJ,aAAA,OACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,cACI,MAAA,CACJ,aAAA,aACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,YACI,MAAA,CACJ,aAAA,WACS,CAChB,CACF,EACF,YAAA,CAAA,EACc,SAAA,CACJ,CACR,MAAA,UACS,UAAA,WACI,MAAA,CACJ,aAAA,UACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,cACI,MAAA,CACJ,aAAA,aACS,CAChB,EACF,CACA,MAAA,QACS,UAAA,0BACI,MAAA,CACJ,aAAA,yBACS,CAChB,EACF,CACA,MAAA,KACS,UAAA,YACI,MAAA,CACJ,aAAA,WACS,CAChB,CACF,EACF,YAAA,CAAA,EACc,SAAA,CACJ,CACR,MAAA,OACS,UAAA,yBACI,MAAA,CACJ,aAAA,wBACS,CAChB,EACF,CACA,MAAA,OACS,UAAA,wBACI,MAAA,CACJ,aAAA,uBACS,CAChB,EACF,CACA,MAAA,QACS,UAAA,yBACI,MAAA,CACJ,aAAA,wBACS,CAChB,EACF,CACA,MAAA,OACS,UAAA,kBACI,MAAA,CACJ,aAAA,iBACS,CAChB,EACF,CACA,MAAA,QACS,UAAA,4BACI,MAAA,CACJ,aAAA,2BACS,CAChB,EA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"}